<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title><%= typeof pageTitle !== 'undefined' ? pageTitle : 'FlowShare' %> | FlowShare</title>
    
    <!-- CSS Stylesheets -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/pages.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/modals.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body class="<%= typeof bodyClass !== 'undefined' ? bodyClass : '' %>">
    
    <!-- ============================================ -->
    <!-- NAVIGATION BAR -->
    <!-- ============================================ -->
    <% if (typeof user !== 'undefined' && user) { %>
        <!-- Authenticated User Navigation -->
        <nav class="navbar">
            <div class="navbar-container">
                <!-- Logo -->
                <div class="navbar-brand">
                    <a href="/home">FlowShare</a>
                </div>
                
                <!-- Navigation Links -->
                <div class="navbar-nav">
                    <% if (typeof group !== 'undefined' && group) { %>
                        <!-- Dashboard page: Show Home link and current group -->
                        <a href="/home" class="nav-link">
                            <span>üè† Home</span>
                        </a>
                        <span class="nav-separator">|</span>
                        <span class="nav-current">
                            <span>üë• <%= group.name %></span>
                        </span>
                    <% } else { %>
                        <!-- Home page: Just show Home indicator -->
                        <span class="nav-current">
                            <span>üè† Home</span>
                        </span>
                    <% } %>
                </div>
                
                <!-- User Menu -->
                <div class="navbar-user">
                    <span class="user-name"><%= user.username %></span>
                    <button id="logout-btn" class="btn-logout" title="Logout">
                        Logout
                    </button>
                </div>
            </div>
        </nav>
    <% } else { %>
        <!-- Public Navigation (Login/Register pages) -->
        <nav class="navbar navbar-public">
            <div class="navbar-container">
                <div class="navbar-brand">
                    <span>FlowShare</span>
                </div>
            </div>
        </nav>
    <% } %>
    
    <!-- ============================================ -->
    <!-- MAIN CONTENT -->
    <!-- ============================================ -->
    <main class="main-content">
        <%- body %>
    </main>
    
    <!-- ============================================ -->
    <!-- FOOTER -->
    <!-- ============================================ -->
    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2024 FlowShare. All rights reserved.</p>
        </div>
    </footer>
    
    <!-- ============================================ -->
    <!-- GLOBAL MODALS -->
    <!-- ============================================ -->
    
    <!-- Logout Confirmation Modal -->
    <% if (typeof user !== 'undefined' && user) { %>
    <div id="logout-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Logout</h3>
                <button class="modal-close" data-modal="logout-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to logout?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-close-modal="logout-modal">Cancel</button>
                <form action="/auth/logout" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Logout</button>
                </form>
            </div>
        </div>
    </div>
    <% } %>
    
    <!-- ============================================ -->
    <!-- JAVASCRIPT -->
    <!-- ============================================ -->
    
    <!-- Core JavaScript -->
    <script src="/js/main.js"></script>
    <script src="/js/modals.js"></script>
    
    <!-- Conditional JavaScript based on page context -->
    <% if (typeof user !== 'undefined' && user) { %>
        <% if (typeof group !== 'undefined' && group) { %>
            <!-- Dashboard page scripts -->
            <script src="/js/dashboard.js"></script>
            <script src="/js/members.js"></script>
            <script src="/js/tasks.js"></script>
            <script src="/js/expenses.js"></script>
        <% } else { %>
            <!-- Home page scripts -->
            <script src="/js/profile.js"></script>
            <script src="/js/groups.js"></script>
        <% } %>
        
        <!-- Global logout handler -->
        <script>
            document.getElementById('logout-btn')?.addEventListener('click', () => {
                document.getElementById('logout-modal').classList.add('active');
            });
        </script>
    <% } %>
    
</body>
</html>
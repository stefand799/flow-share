<script src="/js/components/group-component.js"></script>

<div id="group-container" class="group-card">
    <h2 class="group-title">Group Details</h2>

    <!-- Group Details Display -->
    <div id="group-details" data-group-id="<%= group.id %>" class="group-details">

        <div class="detail-item">
            <p class="detail-label">Group Name</p>
            <p class="detail-value"><%= group.name %></p>
        </div>

        <div class="detail-item">
            <p class="detail-label">Description</p>
            <p class="detail-value detail-description">
                <%= group.description || 'No description provided' %>
            </p>
        </div>

        <div class="detail-item">
            <p class="detail-label">Created</p>
            <p class="detail-value">
                <%= new Date(group.createdAt).toLocaleDateString() %>
            </p>
        </div>

        <% if (typeof members !== 'undefined') { %>
        <div class="detail-item">
            <p class="detail-label">Members</p>
            <p class="detail-value"><%= members.length %> members</p>
        </div>
        <% } %>
    </div>

    <!-- Action Buttons -->
    <div class="group-actions">
        <button id="add-member-btn" class="btn-primary">
            Add Member
        </button>
        
        <% 
        // Check if currentUserMember exists and is admin
        const isAdmin = typeof currentUserMember !== 'undefined' && currentUserMember && currentUserMember.isAdmin;
        %>
        
        <% if (isAdmin) { %>
            <button id="edit-group-btn" class="btn-secondary">
                Edit Group
            </button>
            <button id="delete-group-btn" class="btn-danger">
                Delete Group
            </button>
        <% } %>
    </div>
</div>

<!-- Add Member Modal -->
<div id="add-member-modal" class="modal hidden">
    <div class="modal-content modal-small">
        <h3 class="modal-title">Add Member to Group</h3>

        <form id="add-member-form" action="/api/groups/add-member" method="POST">
            <input type="hidden" name="groupId" value="<%= group.id %>">
            
            <div class="form-group">
                <label for="member-username">Username</label>
                <input 
                    type="text" 
                    id="member-username" 
                    name="username" 
                    required
                    placeholder="Enter username"
                >
                <small style="color: #6b7280; font-size: 0.875rem;">
                    Enter the exact username of the person you want to add
                </small>
            </div>

            <div class="button-group">
                <button type="button" id="cancel-add-member-btn" class="btn-secondary">
                    Cancel
                </button>
                <button type="submit" class="btn-primary">
                    Add Member
                </button>
            </div>
        </form>
    </div>
</div>

<% if (isAdmin) { %>
<!-- Edit Group Modal (Only render if admin) -->
<div id="edit-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="modal-title">Edit Group Details</h3>

        <form id="edit-group-form" action="/api/groups/<%= group.id %>" method="PUT">
            
            <div class="form-content">
                <div class="form-group">
                    <label for="edit-name">Group Name</label>
                    <input 
                        type="text" 
                        id="edit-name" 
                        name="name" 
                        value="<%= group.name %>"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <textarea 
                        id="edit-description" 
                        name="description" 
                        rows="4"
                    ><%= group.description || '' %></textarea>
                </div>
            </div>

            <div class="button-group">
                <button type="button" id="cancel-edit-btn" class="btn-secondary">
                    Cancel
                </button>
                <button type="submit" class="btn-primary">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Group Modal (Only render if admin) -->
<div id="delete-modal" class="modal hidden">
    <div class="modal-content modal-small">
        <h3 class="modal-title modal-title-danger">⚠️ Delete Group</h3>
        
        <p class="modal-message">
            <strong style="color: #dc2626;">WARNING:</strong> Deleting this group is permanent. All tasks, expenses, and data will be lost.
        </p>

        <p class="modal-message" style="margin-top: 1rem;">
            Are you sure you want to delete "<%= group.name %>"?
        </p>

        <form id="delete-group-form" action="/api/groups/<%= group.id %>" method="DELETE">
            <div class="button-group">
                <button type="button" id="cancel-delete-btn" class="btn-secondary">
                    Cancel
                </button>
                <button type="submit" class="btn-danger">
                    Yes, Delete Group
                </button>
            </div>
        </form>
    </div>
</div>
<% } %>